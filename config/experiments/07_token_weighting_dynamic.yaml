experiment_name: token_weighting_dynamic
description: 특수 토큰 동적 가중치 조정 실험 - 학습 진행에 따라 가중치 점진적 조정

# 모델 구성
model:
  name: digit82/kobart-summarization
  architecture: kobart

# 토크나이저 구성  
tokenizer:
  encoder_max_len: 512
  decoder_max_len: 200
  bos_token: "<s>"
  eos_token: "</s>"
  special_tokens:
    - '#Person1#'
    - '#Person2#'
    - '#Person3#'
    - '#PhoneNumber#'
    - '#Address#'
    - '#DateOfBirth#'
    - '#PassportNumber#'
    - '#SSN#'
    - '#CardNumber#'
    - '#CarNumber#'
    - '#Email#'

# 학습 구성
training:
  num_train_epochs: 20
  learning_rate: 2.0e-05
  per_device_train_batch_size: 16
  per_device_eval_batch_size: 16
  gradient_accumulation_steps: 4  # 효과적인 배치 크기 = 64
  warmup_steps: 500
  weight_decay: 0.01
  seed: 42
  evaluation_strategy: epoch
  save_strategy: epoch
  save_total_limit: 3
  logging_steps: 50
  load_best_model_at_end: true
  metric_for_best_model: "eval_rouge_combined_f1"
  greater_is_better: true
  fp16: true
  gradient_checkpointing: true
  
  # 조기 종료
  early_stopping_patience: 3
  early_stopping_threshold: 0.001
  
  # 데이터로더 설정
  dataloader_num_workers: 4
  dataloader_drop_last: false
  group_by_length: true
  predict_with_generate: true
  remove_unused_columns: true

# 특수 토큰 가중치 설정
token_weighting:
  enabled: true
  loss_type: "dynamic"  # 동적 가중치 사용
  
  # 동적 가중치 설정
  dynamic_weights:
    initial_special_weight: 3.0   # 초기에는 높은 가중치
    final_special_weight: 1.5     # 최종적으로는 낮은 가중치
    warmup_steps: 1000           # 가중치 증가 단계
    decay_steps: 5000            # 가중치 감소 단계
  
  # 레이블 스무딩
  label_smoothing: 0.1
  
  # 로깅 설정
  log_token_stats: true
  log_frequency: 100  # 몇 스텝마다 토큰별 손실 로깅
  log_weight_changes: true  # 가중치 변화 로깅

# 생성 구성
generation:
  max_length: 200
  min_length: 30
  num_beams: 4
  no_repeat_ngram_size: 2
  early_stopping: true
  length_penalty: 1.0
  temperature: 1.0
  do_sample: false

# 추론 구성
inference:
  batch_size: 16
  generate_max_length: 200
  remove_tokens:
    - '<usr>'
    - '<s>'
    - '</s>'
    - '<pad>'

# 평가 메트릭
evaluation:
  metrics:
    - rouge  # 기본 ROUGE 점수
    - special_token_accuracy  # 특수 토큰 정확도
    - pii_recall  # PII 토큰 재현율
    - speaker_consistency  # 화자 일관성
  
  special_token_eval:
    compute_per_token_metrics: true
    report_missing_tokens: true
    strict_matching: false  # 부분 매칭 허용

# WandB 구성
wandb:
  name: "07_token_weighting_dynamic"
  notes: "특수 토큰 동적 가중치 실험 - 초기 3.0x에서 1.5x로 점진적 감소"
  tags: ["token_weighting", "dynamic_weights", "special_tokens", "pii", "kobart"]
  
  # 추가 로깅
  log_gradients: true
  log_token_distribution: true
  log_weight_schedule: true
  
# 데이터 구성
data:
  train_file: "train.csv"
  dev_file: "dev.csv"
  test_file: "test.csv"

# 모니터링 설정
monitoring:
  log_memory_usage: true
  log_training_speed: true
  log_special_token_stats: true
  
  # 특수 토큰 모니터링
  track_tokens:
    - category: "pii"
      tokens: ['#PhoneNumber#', '#Address#', '#DateOfBirth#', '#PassportNumber#', '#SSN#', '#CardNumber#', '#CarNumber#', '#Email#']
    - category: "speaker"
      tokens: ['#Person1#', '#Person2#', '#Person3#']
  
  # 가중치 스케줄 시각화
  plot_weight_schedule: true
  save_plots_every: 1000  # 스텝

# Generation settings
generation:
  max_length: 256
  min_length: 5
  num_beams: 4
  no_repeat_ngram_size: 2
\ntraining:\n  eval_strategy: no
